<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<div id="app">
<el-table
      :data="tableData"
      style="width: 100%">
      <el-table-column
        prop="name"
        label="应用名称">
      </el-table-column>
       <el-table-column
          prop="port"
          label="端口">
        </el-table-column>
      <el-table-column
        prop="status"
        label="状态">
      </el-table-column>
      <el-table-column
            fixed="right"
            label="操作"
            width="100">
            <template slot-scope="scope">
              <el-button type="danger" size="small" @click="del(scope.row)" >删除</el-button>
            </template>
          </el-table-column>
    </el-table>
    <el-button type="success" size="small" @click="dialogFormVisible = true">添加服务监控</el-button>
    <el-dialog title="新增监控服务" :visible.sync="dialogFormVisible">
      <el-form :model="form">
        <el-form-item label="服务名称" :label-width="formLabelWidth">
          <el-input v-model="form.name" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="服务端口" :label-width="formLabelWidth">
          <el-input v-model.number="form.port" autocomplete="off"></el-input>
        </el-form-item>
      </el-form>
      <div slot="footer" class="dialog-footer">
        <el-button @click="dialogFormVisible = false">取 消</el-button>
        <el-button type="primary" @click="saveServer">确 定</el-button>
      </div>
    </el-dialog>
</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    const instance = axios.create({
      baseURL: window.location.origin,
      timeout: 1000
    });
  var app = new Vue({
    el: '#app',
    data: {
       tableData: [],
       dialogFormVisible:false,
       form: {
             name: '',
             port: ''
           },
           formLabelWidth: '120px'
    },
   mounted: function () {
    window.mysocket = new WebSocket('ws://' + window.location.host + '/websocket');
    window.mysocket.addEventListener('message', this.messageListener)
    this.getServer()
    },
    methods: {
        messageListener: function(event){
            this.tableData = JSON.parse(event.data)
        },
        getServer: function() {
            var _this = this
            instance.get('/server')
                   .then(function (response) {
                     _this.tableData = response.data
                   })
                   .catch(function (error) {
                     console.log(error);
                   })
        },
        saveServer: function() {
          var _this = this
          _this.dialogFormVisible=false
          instance.post('/server', _this.form)
                 .then(function (response) {
                 _this.$message({
                      message: '保存成功',
                      type: 'success',
                      duration: 1000
                    });
                   _this.getServer()
                 })
                 .catch(function (error) {
                   console.log(error);
                 })
      },
        del: function (row) {
        var _this = this
            instance.delete('/server', {data:{"port":row.port}})
                   .then(function (response) {
                   _this.$message({
                             message: '删除成功',
                             type: 'success',
                             duration: 1000
                           });
                     _this.getServer()
                   })
                   .catch(function (error) {
                     console.log(error);
                   });
        }
      }
  })
</script>
</html>